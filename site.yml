---
- hosts: jyboss

  roles:
    - role: ansible-rsyslog
      tags: ['common']
    - role: ansible-jython
      tags: ['common']

  tasks:
    - debug: var=jython_home
    - debug: var=jyboss_version

    - name: "Download JyBoss Python Package (pip does not work properly behind proxy)"
      include: roles/ansible-jython/tasks/dl/download-{{ dl_mode | default('local') }}.yml
      vars:
        module: "jyboss-{{ jyboss_version }}.tar.gz"
        url: "https://github.com/bertramn/jyboss-cli/releases/download/v{{ jyboss_version }}/jyboss-{{ jyboss_version }}.tar.gz"
      tags: ['common']

    - name: Install JyBoss Python Package
      pip:
        name: "{{ download_dir }}/jyboss-{{ jyboss_version }}.tar.gz"
        executable: "{{ jython_home }}/bin/pip"
      tags: ['common']

    - name: Connect to JBoss For Facts
      jboss:
        jboss_home: "{{ jboss_home }}"
        facts: yes
      tags: ['jboss']
